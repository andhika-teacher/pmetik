<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kelas Informatika</title>
  <style>
    /* ==== GLOBAL THEME ==== */
    body {
      font-family: "Poppins", sans-serif;
      margin: 0;
      padding: 0;
      background: url('background.jpg') no-repeat center center fixed;
      background-size: cover;
      color: #f1f1f1;
      transition: background 0.5s ease-in-out;
    }

    header {
      background: rgba(0, 123, 255, 0.85);
      color: #fff;
      padding: 25px;
      text-align: center;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(6px);
    }

    header h1 {
      font-size: 2rem;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      text-shadow: 0 0 10px #00c3ff;
    }

    /* ==== NAVIGATION ==== */
    nav {
      background: rgba(20, 20, 20, 0.85);
      color: #fff;
      padding: 10px;
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 10px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(8px);
    }

    nav button {
      background: linear-gradient(90deg, #0f2027, #203a43, #2c5364);
      color: #fff;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      letter-spacing: 0.5px;
      transition: all 0.3s ease;
    }

    nav button:hover {
      background: linear-gradient(90deg, #007BFF, #00bcd4);
      transform: scale(1.05);
      box-shadow: 0 0 12px #00bcd4;
    }

    /* ==== SECTIONS ==== */
    section {
      padding: 25px;
      margin: 25px auto;
      width: 90%;
      max-width: 900px;
      background: rgba(0, 0, 0, 0.65);
      border-radius: 15px;
      box-shadow: 0 0 20px rgba(0, 255, 255, 0.15);
      backdrop-filter: blur(8px);
      animation: fadeIn 0.8s ease;
    }

    h2 {
      text-align: center;
      color: #00bcd4;
      text-shadow: 0 0 8px #00bcd4;
    }

    .hidden { display: none; }

    /* ==== TABLE ==== */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
      color: #fff;
    }

    th, td {
      border: 1px solid rgba(255, 255, 255, 0.2);
      padding: 10px;
      text-align: center;
    }

    th {
      background: rgba(0, 123, 255, 0.3);
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    td {
      background: rgba(255, 255, 255, 0.05);
    }

    /* ==== BUTTONS ==== */
    button {
      font-family: inherit;
      transition: all 0.3s ease;
    }

    button:hover {
      transform: scale(1.05);
    }

    .logout-btn {
      display: block;
      margin: 20px auto;
      background: linear-gradient(90deg, #ff4b2b, #ff416c);
      color: white;
      border: none;
      padding: 10px 25px;
      border-radius: 25px;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 0 12px rgba(255, 65, 108, 0.5);
    }

    .logout-btn:hover {
      background: linear-gradient(90deg, #ff6b6b, #ff4757);
      box-shadow: 0 0 18px rgba(255, 107, 107, 0.8);
    }

    /* ==== PRODUCT BOX ==== */
    .product-box {
      display: inline-block;
      width: 200px;
      height: 200px;
      border: 2px solid rgba(255, 255, 255, 0.1);
      border-radius: 15px;
      text-align: center;
      margin: 10px;
      background: rgba(255, 255, 255, 0.05);
      box-shadow: 0 0 10px rgba(0, 255, 255, 0.1);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .product-box:hover {
      transform: translateY(-5px);
      box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
    }

    .product-box h4 {
      margin-top: 20px;
      color: #00bcd4;
    }

    .redeem-btn {
      margin-top: 10px;
      background: linear-gradient(90deg, #28a745, #00c851);
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 10px;
      cursor: pointer;
      font-weight: bold;
      letter-spacing: 0.5px;
    }

    .redeem-btn:disabled {
      background: #666;
      cursor: not-allowed;
    }

    /* ==== USER INFO ==== */
    #userInfo {
      text-align: center;
      margin: 15px;
      font-weight: bold;
      color: #fff;
      background: rgba(0, 0, 0, 0.4);
      padding: 10px;
      border-radius: 10px;
      display: inline-block;
      box-shadow: 0 0 10px rgba(0, 255, 255, 0.2);
    }

    /* ==== ANIMATION ==== */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* ==== INPUT STYLING ==== */
    input[type="text"], input[type="password"] {
      width: 80%;
      padding: 10px;
      margin-top: 8px;
      border: none;
      border-radius: 8px;
      outline: none;
      background: rgba(255, 255, 255, 0.1);
      color: #fff;
      box-shadow: 0 0 5px rgba(0,255,255,0.2);
    }

    input:focus {
      box-shadow: 0 0 10px rgba(0,255,255,0.5);
    }

    /* ==== KARYAKU ==== */
    .gallery {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .gallery-item {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      overflow: hidden;
      text-align: center;
      box-shadow: 0 0 10px rgba(0, 255, 255, 0.2);
      transition: transform 0.3s ease;
    }

    .gallery-item:hover {
      transform: translateY(-5px);
      box-shadow: 0 0 20px rgba(0, 255, 255, 0.4);
    }

    .gallery-item img {
      width: 100%;
      height: 150px;
      object-fit: cover;
    }

    .gallery-item button {
      background: linear-gradient(90deg, #00bcd4, #007BFF);
      color: #fff;
      border: none;
      padding: 8px 12px;
      border-radius: 8px;
      margin: 10px 0 15px;
      cursor: pointer;
      font-weight: bold;
    }

    /* ==== ROBLOX INFORMATIKA ==== */
    .roblox-container {
      position: relative;
      width: 100%;
      max-width: 900px;
      margin: 0 auto;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 0 20px rgba(0,255,255,0.3);
    }

    .roblox-container img {
      width: 100%;
      height: auto;
      display: block;
    }

    .roblox-container button {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: linear-gradient(90deg, #ff8c00, #ff6600);
      border: none;
      color: white;
      padding: 12px 25px;
      border-radius: 25px;
      font-size: 1.1em;
      cursor: pointer;
      font-weight: bold;
      box-shadow: 0 0 20px rgba(255, 140, 0, 0.6);
      transition: all 0.3s ease;
    }

    .roblox-container button:hover {
      transform: translate(-50%, -50%) scale(1.08);
      box-shadow: 0 0 30px rgba(255, 165, 0, 0.8);
    }
  </style>
</head>
<body>

<header>
  <h1>PMATIK (Portal Media Informatika)</h1>
  <h3>by Mr Andhika</h3>
</header>

<!-- Semua struktur dan script di bawah TIDAK DIUBAH -->
<section id="loginSection">
  <h2>Login</h2>
  <label for="username">Username:</label>
  <input type="text" id="username"><br><br>
  <label for="password">Password:</label>
  <input type="password" id="password"><br><br>
  <button onclick="login()">Masuk</button>
</section>

<section id="menuSection" class="hidden">
  <nav>
    <button onclick="showPage('nilai')">Cek Nilai</button>
    <button onclick="showPage('redeem')">Redeem Poin</button>
    <button onclick="showPage('materi')">Materi</button>
    <button onclick="showPage('karyaku')">Karyaku</button>
    <button onclick="showPage('roblox')">Roblox Informatika</button>
    <button id="adminMenu" class="hidden" onclick="showPage('admin')">Admin</button>
  </nav>

  <div id="userInfo"></div>

  <div id="content">
    <section id="nilai" class="hidden">
      <h2>Cek Nilai</h2>
      <table id="nilaiTable"></table>
    </section>

    <section id="redeem" class="hidden">
      <h2>Redeem Poin</h2>
      <p id="poinInfo">Poin Anda: 0</p>
      <label for="redeemCode">Masukkan Kode Redeem:</label>
      <input type="text" id="redeemCode">
      <button onclick="redeemPoin()">Redeem</button>
      <div id="redeemResult"></div>
      <h3>Barang yang Bisa Ditukar</h3>
      <div id="barangList"></div>
      <h3>Riwayat</h3>
      <table id="riwayatTable"></table>
    </section>

    <section id="materi" class="hidden">
      <h2>Materi Pembelajaran</h2>
      <button onclick="window.open('https://drive.google.com','_blank')">Google Drive</button>
      <button onclick="window.open('https://forms.google.com','_blank')">Google Form</button>
      <button onclick="window.open('https://youtube.com','_blank')">YouTube</button>
      <button onclick="window.open('https://kemdikbud.go.id','_blank')">Situs Resmi</button>
    </section>

    <!-- ==== MENU BARU: KARYAKU ==== -->
    <section id="karyaku" class="hidden">
      <h2>Karyaku</h2>
      <div class="gallery">
        <div class="gallery-item">
          <img src="img/ky1.jpeg" alt="Karya 1">
          <button onclick="window.open('https://contoh-link-1.com','_blank')">Akses</button>
        </div>
        <div class="gallery-item">
          <img src="img/ky2.jpeg" alt="Karya 2">
          <button onclick="window.open('https://contoh-link-2.com','_blank')">Akses</button>
        </div>
        <div class="gallery-item">
          <img src="img/ky3.jpeg" alt="Karya 3">
          <button onclick="window.open('https://contoh-link-3.com','_blank')">Akses</button>
        </div>
      </div>
    </section>

    <!-- ==== MENU BARU: ROBLOX INFORMATIKA ==== -->
    <section id="roblox" class="hidden">
      <h2>Roblox Informatika</h2>
      <div class="roblox-container">
        <img src="img/rbx.jpeg" alt="Roblox Informatika">
        <button onclick="window.open('https://www.roblox.com','_blank')">Masuk Roblox</button>
      </div>
    </section>

    <section id="admin" class="hidden">
      <h2>Panel Admin</h2>
      <button onclick="resetRiwayat()">Reset Semua Riwayat</button>
      <p id="resetStatus"></p>
    </section>
  </div>

  <button class="logout-btn" onclick="logout()">Logout</button>
</section>

<!-- SCRIPT ASLI TIDAK DIUBAH -->
<script>
   const API_URL = "https://script.google.com/macros/s/AKfycbxaZ9EUj2e0GK1W5ySBLG7oQPd7-Eb6Z7luVP8VUa9SrfF_GEGvN5EdY_xlhkFTRH_PPw/exec";

  let currentUser = null;
  let siswaData = [];
  let barangData = [];
  let riwayatUser = [];

  async function fetchData(sheet) {
    const res = await fetch(`${API_URL}?sheet=${sheet}`);
    return await res.json();
  }

  async function login() {
    const user = document.getElementById("username").value.trim();
    const pass = document.getElementById("password").value.trim();
    if (!user || !pass) return alert("Isi username dan password!");

    const siswa = await fetchData("Siswa");
    const admin = await fetchData("Admin");

    const foundSiswa = siswa.find(s => s.Username === user && s.Password === pass);
    const foundAdmin = admin.find(a => a.Username === user && a.Password === pass);

    if (foundSiswa) {
      currentUser = foundSiswa;
      siswaData = siswa;
      barangData = await fetchData("Barang");
      showMainMenu("siswa");
    } else if (foundAdmin) {
      currentUser = foundAdmin;
      showMainMenu("admin");
    } else {
      alert("âŒ Username atau Password salah!");
    }
  }

  function showMainMenu(role) {
    document.getElementById("loginSection").classList.add("hidden");
    document.getElementById("menuSection").classList.remove("hidden");

    if (role === "admin") {
      document.getElementById("adminMenu").classList.remove("hidden");
      document.getElementById("userInfo").innerText = "ðŸ‘‘ Admin Mode";
    } else {
      document.getElementById("adminMenu").classList.add("hidden");
      document.getElementById("poinInfo").innerText = "Poin Anda: " + (currentUser.Poin || 0);

      // ðŸ†• Tambahan: Tampilkan nama dan kelas siswa
      document.getElementById("userInfo").innerText = `ðŸ‘¤ ${currentUser.Nama} | Kelas: ${currentUser.Kelas}`;

      tampilkanBarang();
      tampilkanNilai();
      tampilkanRiwayat();
    }
  }

  function showPage(page) {
    document.querySelectorAll('#content section').forEach(s => s.classList.add('hidden'));
    document.getElementById(page).classList.remove('hidden');
  }

  function tampilkanNilai() {
    const n = currentUser;
    let html = `
      <tr><th>Latihan 1</th><th>Latihan 2</th><th>Latihan 3</th><th>Tugas</th><th>Ujian</th></tr>
      <tr>
        <td>${n["Nilai Latihan 1"]}</td>
        <td>${n["Nilai Latihan 2"]}</td>
        <td>${n["Nilai Latihan 3"]}</td>
        <td>${n["Nilai Tugas"]}</td>
        <td>${n["Nilai Ujian"]}</td>
      </tr>`;
    document.getElementById("nilaiTable").innerHTML = html;
  }

  async function redeemPoin() {
    const code = document.getElementById("redeemCode").value.trim();
    if (!code) return alert("Masukkan kode terlebih dahulu!");
    const kodeData = await fetchData("KodeRedeem");
    const kode = kodeData.find(k => k.Kode === code);
    if (!kode) return alert("Kode tidak valid!");

    let poinBaru = parseInt(currentUser.Poin || 0) + parseInt(kode.Poin);
    currentUser.Poin = poinBaru;
    document.getElementById("poinInfo").innerText = "Poin Anda: " + poinBaru;
    document.getElementById("redeemResult").innerText = `âœ… Kode valid! Anda mendapat ${kode.Poin} poin.`;

    await updateSiswa(currentUser.ID, poinBaru, currentUser["Riwayat Barang"]);
  }

  function tampilkanBarang() {
    const container = document.getElementById("barangList");
    container.innerHTML = "";
    barangData.forEach(b => {
      const box = document.createElement("div");
      box.className = "product-box";
      box.innerHTML = `<h4>${b["Nama Barang"]}</h4><p>${b["Harga Poin"]} poin</p>`;
      const btn = document.createElement("button");
      btn.innerText = "Tukar";
      btn.className = "redeem-btn";
      btn.onclick = () => tukarBarang(b);
      box.appendChild(btn);
      container.appendChild(box);
    });
  }

  async function tukarBarang(b) {
    let poinSekarang = parseInt(currentUser.Poin);
    const harga = parseInt(b["Harga Poin"]);

    if (poinSekarang < harga) {
      alert("âŒ Poin Anda tidak cukup!");
      return;
    }

    poinSekarang -= harga;
    currentUser.Poin = poinSekarang;
    const waktu = new Date().toLocaleString();
    const riwayat = (currentUser["Riwayat Barang"] || "") + `\n${b["Nama Barang"]} (${harga} poin) - ${waktu}`;
    currentUser["Riwayat Barang"] = riwayat;

    document.getElementById("poinInfo").innerText = "Poin Anda: " + poinSekarang;
    tampilkanRiwayat();
    alert(`âœ… Berhasil menukar ${b["Nama Barang"]} pada ${waktu}`);

    await updateSiswa(currentUser.ID, poinSekarang, riwayat);
  }

  function tampilkanRiwayat() {
    const riwayat = (currentUser["Riwayat Barang"] || "").split("\n").filter(r => r.trim() !== "");
    let html = "<tr><th>Barang</th></tr>";
    riwayat.forEach(r => html += `<tr><td>${r}</td></tr>`);
    document.getElementById("riwayatTable").innerHTML = html;
  }

  async function updateSiswa(id, poin, riwayat) {
    await fetch(API_URL + "?sheet=Siswa", {
      method: "POST",
      body: JSON.stringify({ ID: id, Poin: poin, Riwayat: riwayat }),
      headers: { "Content-Type": "application/json" }
    });
  }

  async function resetRiwayat() {
    await fetch(API_URL + "?sheet=Siswa", {
      method: "POST",
      body: JSON.stringify({ reset: true }),
      headers: { "Content-Type": "application/json" }
    });
    document.getElementById("resetStatus").innerText = "âœ… Semua riwayat berhasil direset!";
  }

  function logout() {
    currentUser = null;
    document.getElementById("menuSection").classList.add("hidden");
    document.getElementById("loginSection").classList.remove("hidden");
  }
</script>

</body>
</html>
